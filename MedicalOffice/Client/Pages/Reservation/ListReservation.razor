@inherits ListReserveBase
@page "/admin/reservation"
@using MedicalOffice.Shared.DTO;
@using MedicalOffice.Client.Services.Helper
<MudIconButton OnClick="@OpenAddDialogAdd" Icon="@Icons.Material.Filled.Add"
               Color="Color.Success"></MudIconButton>

<MudIconButton OnClick="@OpenAddDialogEdit" Icon="@Icons.Material.Filled.Edit"
               Color="Color.Warning"></MudIconButton>


<MudIconButton Icon="@Icons.Material.Filled.Delete" aria-label="delete"
               Color="Color.Error" OnClick="OnButtonClicked"></MudIconButton>

<MudTable ServerData="@(new Func<TableState, Task<TableData<ReserveDto>>>(ServerReload))"
          Dense="true"
          Hover="true"
          @ref="ReserveTable"
          Bordered="true"
          CanCancelEdit="true"
          SortLabel="Sort By"
          CommitEditTooltip="Commit Edit"
          OnCommitEditClick="@(() => Snackbar.Add("عملیات ویرایش با موفقیت انجام شد"))"
          RowEditPreview="BackupItem"
          RowEditCancel="ResetItemToOriginalValues"
          RowEditCommit="ItemHasBeenCommitted"
          IsEditRowSwitchingBlocked="true"
          ApplyButtonPosition="@TableApplyButtonPosition.End"
          EditButtonPosition="@TableEditButtonPosition.End"
          EditTrigger="@TableEditTrigger.EditButton"
          OnRowClick="@OnRowClick"
          MultiSelection="true"
          @bind-SelectOnRowClick="@_selectOnRowClick"
          @bind-SelectedItems="selectedItems"
          T="ReserveDto" 
          Items="@listReserve">


    <ToolBarContent>

        <MudText Typo="Typo.h6">
            پروژه ها
        </MudText>
        <MudSpacer />

    </ToolBarContent>

    <HeaderContent>
        <MudTh><MudTableSortLabel SortLabel="FirstName" T="User">نام </MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortLabel="LastName" T="User">نام خانوادگی </MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortLabel="NationalCode" T="User"> کد ملی </MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortLabel="Mobile" T="User"> موبایل  </MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortLabel="Day" T="User"> روز  </MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortLabel="Day" T="User"> تاریخ  </MudTableSortLabel></MudTh>

        <MudTh><MudTableSortLabel SortLabel="FromTime" T="User"> ساعت  </MudTableSortLabel></MudTh>


    </HeaderContent>

    <RowTemplate>

        <MudTd DataLabel="FirstName">@context.FirstName </MudTd>
        <MudTd DataLabel="LastName">@context.LastName </MudTd>
        <MudTd DataLabel="NationalCode">@context.NationalCode</MudTd>
        <MudTd DataLabel="Mobile">@context.Mobile </MudTd>
   
        @if(@context.Day.HasValue)
        {
            <MudTd DataLabel="Day"> @context.Day.Value.ToDayShamsi() </MudTd>
        }
        else
        {
            <MudTd DataLabel="Day"> </MudTd>            
        }
        @if (@context.Day.HasValue)
        {
            <MudTd DataLabel="Day"> @context.Day.Value.ToShamsi() </MudTd>
        }
        else
        {
            <MudTd DataLabel="Day"> </MudTd>
        }
        @if (@context.FromTime.HasValue && @context.ToTime.HasValue)
        {
            <MudTd DataLabel="FromTime"> @context.FromTime.Value.ToString("hh\\:mm") - @context.ToTime.Value.ToString("hh\\:mm")</MudTd>
        }
        else
        {
            <MudTd DataLabel="FromTime"> </MudTd>

        }
    </RowTemplate>

        <RowEditingTemplate>

         <MudTd DataLabel="FirstName">
                <MudTextField @bind-Value="@context.FirstName" Required />
         </MudTd>

         <MudTd DataLabel="LastName">
             <MudTextField @bind-Value="@context.LastName" Required />
         </MudTd>

         <MudTd DataLabel="NationalCode">
             <MudTextField @bind-Value="@context.NationalCode" Required />
         </MudTd>

         <MudTd DataLabel="Mobile">
             <MudTextField @bind-Value="@context.Mobile" Required />
         </MudTd>

     </RowEditingTemplate>

     <NoRecordsContent>
         <MudText>رکوردی وجود ندارد.</MudText>
     </NoRecordsContent>

     <LoadingContent>
         <MudText>در حال بارگیری...</MudText>
     </LoadingContent>

     <PagerContent>
         <MudTablePager />
     </PagerContent>

     <EditButtonContent Context="button">
         <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" Class="pa-0"
                        OnClick="@button.ButtonAction" Disabled="@button.ButtonDisabled" />
     </EditButtonContent>


 </MudTable>


 <MudMessageBox @ref="mbox" Title="حذف" CancelText="لغو">
     <MessageContent>
         آیا از حذف
         @(
           selectedItems == null ? "" :
               string.Join(", ", selectedItems.OrderBy(x => x.Id).Select(x =>new { x.FirstName ,x.LastName}))
           )
        مطمئن هستید؟
    </MessageContent>
    <YesButton>
        <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="DeleteReserves"
                   StartIcon="@Icons.Material.Filled.DeleteForever">حذف</MudButton>
    </YesButton>
</MudMessageBox>